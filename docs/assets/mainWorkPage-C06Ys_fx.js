import{u as ie}from"./Container-CqWXdJoC.js";import{_ as de}from"./tres3dprop.vue_vue_type_style_index_0_lang-C8tVGt0e.js";import{d as ve,B as K,x as me,r as f,y as ce,f as pe,q as T,j as i,m as c,b as a,c as d,s as O,a as t,F as B,p as U,e as g,h as v,t as o,E as be,l as W,o as u,_ as fe}from"./index-BlqbEepj.js";import{E as ye}from"./EChartsPie-DLmyLU7R.js";import{u as xe}from"./Box-D_V-zui9.js";const ge=X=>new Promise((P,S)=>{const _=new Worker(new URL("/assets/block.worker-DPpeyo2Q.js",import.meta.url),{type:"module"});_.onmessage=s=>{s.data.type==="SUCCESS"?(P(s.data.data),_.terminate()):(S(new Error(s.data.error)),_.terminate())},_.postMessage({type:"CALCULATE",data:JSON.parse(JSON.stringify(X))})}),_e={key:0,class:"show"},we={class:"containerstep"},ke={class:"boxstep"},Ce={key:1,class:"show"},Ve={class:"carbox"},Se={class:"carbox"},he={key:2,class:"show"},ze={class:"sidebarbox"},Ee={key:0,class:"sidebarbox"},Be={key:1,class:"sidebarbox",style:{height:"500px"}},Ue={key:2},$e={key:0,class:"hw2"},Ae=["onClick"],Fe={key:0,class:"hw2"},Le=["onClick"],Ne={style:{padding:"12px","border-top":"1px solid var(--el-border-color)"}},De=ve({__name:"mainWorkPage",setup(X){const P=ie(),{container_list:S}=K(P),_=me(()=>{if(!n.value||!n.value.container||!n.value.container.allmodules)return[0,0,0];let r=0,e=0,y=0;const C=[...n.value.container.allmodules];for(const j of C){const[D,M,R]=j.centerPosition;r+=D,e+=M,y+=R}const p=C.length,x=r/p,b=e/p,E=y/p;return[x,b,E]}),s=f(0),n=f(),h=r=>r.map(e=>e.toFixed(1)),ee=()=>{if(++s.value>2){s.value=2;return}s.value==0?console.log(s.value):s.value==1?(console.log(s.value),oe()):s.value==2&&(async()=>{const r=be.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{n.value=await ge(k),F(n.value.container.allbox,n.value.container.allmodules,n.value.container.gravityCenter)}catch(e){console.log("计算失败",e)}finally{r.close()}})()},le=()=>{if(--s.value<0){s.value=0;return}},te=xe(),{Box_list:w}=K(te),N=f(!1),$=f(!1),V=f([]),A=f([]),z=f(0);ce(V,r=>{r.length===0?(N.value=!1,$.value=!1):r.length===w.value.length?(N.value=!0,$.value=!1):$.value=!0,A.value=new Array(r.length).fill(1),console.log("Selected  goods:",V.value)});const ne=r=>{$.value=!1,r?(V.value=w.value.map((e,y)=>y),console.log("All  goods selected")):(V.value=[],console.log("All  goods deselected"))};let k=pe({name:S.value[z.value].name,containers:[],boxes:[],num_list:[]});const Y=f(),Z=f();function oe(){if(V.value.length<=0){W({message:"请选择货物"}),s.value=0;return}else if(V.value.length!==A.value.length){W({message:"货物数量异常"}),s.value=0;return}else if(z.value<0||z.value>=S.value.length){W({message:"请选择集装箱"}),s.value=1;return}const r=S.value[z.value],e=r.module;e.length==0&&e.push({lx:r.lx,ly:r.ly,lz:r.lz,name:r.name,x:0,y:0,z:0}),k={name:S.value[z.value].name,containers:e,boxes:[],num_list:A.value};for(const p of V.value){const x=w.value[p];k.boxes.push({lx:x.lx,ly:x.ly,lz:x.lz,id:p,mass:x.mass})}const y=new Set;k.boxes.forEach(p=>{y.add(w.value[p.id].name)});const C=new Map;k.boxes.forEach((p,x)=>{const b=w.value[p.id].name,E=k.num_list[x];C.has(b)?C.set(b,C.get(b)+E):C.set(b,E)}),Y.value=Array.from(y),Z.value=Array.from(C.entries()).map(([p,x])=>({value:x,name:p}))}const ae=f([]),q=f([]),J=f([]),I=f([0,0,0]);function F(r=[],e=[],y){q.value=e,I.value=y,J.value=r}return(r,e)=>{const y=c("el-option"),C=c("el-select"),p=c("el-checkbox"),x=c("el-input-number"),b=c("el-table-column"),E=c("el-table"),j=c("el-main"),D=c("el-container"),M=c("el-step"),R=c("el-steps"),se=c("el-scrollbar"),Q=c("el-button"),H=c("el-col"),ue=c("el-row"),re=c("el-aside");return u(),T(D,{class:"layout-container",style:{height:"100%"}},{default:i(()=>[a(D,null,{default:i(()=>[a(j,null,{default:i(()=>[s.value==0?(u(),d("div",_e,[e[6]||(e[6]=t("h1",null,"- 选择集装箱",-1)),t("div",we,[a(C,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=l=>z.value=l),placeholder:"Select",size:"large",style:{width:"240px"}},{default:i(()=>[(u(!0),d(B,null,U(g(S),(l,m)=>(u(),T(y,{key:l.name,label:l.name,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e[7]||(e[7]=t("h1",null,"- 选择货物种类及数量",-1)),a(C,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=l=>V.value=l),multiple:"",clearable:"","collapse-tags":"",placeholder:"Select goods","popper-class":"custom-header","max-collapse-tags":1,style:{width:"240px"}},{header:i(()=>[a(p,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=l=>N.value=l),indeterminate:$.value,onChange:ne},{default:i(()=>e[5]||(e[5]=[v(" 全选 ")])),_:1},8,["modelValue","indeterminate"])]),default:i(()=>[(u(!0),d(B,null,U(g(w),(l,m)=>(u(),T(y,{key:m,label:l.name,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(u(!0),d(B,null,U(V.value,(l,m)=>(u(),d("div",ke,[v(" 货物 "+o(g(w)[l].name)+" 数量为 ",1),a(x,{min:1,modelValue:A.value[m],"onUpdate:modelValue":L=>A.value[m]=L},null,8,["modelValue","onUpdate:modelValue"])]))),256))])):s.value==1?(u(),d("div",Ce,[e[9]||(e[9]=t("h2",null,"最终确认",-1)),t("div",Ve," 集装箱："+o(g(k).name),1),t("div",Se,[e[8]||(e[8]=t("h3",null,"货物清单",-1)),a(E,{data:g(k).boxes,stripe:"",style:{width:"100%"}},{default:i(()=>[a(b,{prop:"id",label:"编号",width:"auto"}),a(b,{label:"货物名称",width:"auto"},{default:i(({row:l})=>[v(o(g(w)[l.id].name),1)]),_:1}),a(b,{prop:"lx",label:"长",width:"auto"}),a(b,{prop:"ly",label:"宽",width:"auto"}),a(b,{prop:"lz",label:"高",width:"auto"}),a(b,{label:"数量",width:"auto"},{default:i(({row:l,$index:m})=>[v(o(g(k).num_list[m]),1)]),_:1}),a(b,{label:"货物质量",width:"auto"},{default:i(({row:l})=>[v(o(g(w)[l.id].mass),1)]),_:1})]),_:1},8,["data"])])])):s.value==2?(u(),d("div",he,[a(de,{main_containers:ae.value,module_containers:q.value,boxes:J.value,centerOfGravity:I.value},null,8,["main_containers","module_containers","boxes","centerOfGravity"])])):O("",!0)]),_:1})]),_:1}),a(re,{"max-width":"25%",style:{display:"flex","flex-direction":"column"}},{default:i(()=>[a(se,null,{default:i(()=>[t("div",ze,[a(R,{style:{"max-width":"600px"},active:s.value,"finish-status":"success","align-center":""},{default:i(()=>[a(M),a(M)]),_:1},8,["active"])]),s.value==0?(u(),d("div",Ee," - 选择集装箱、货物种类及数量 ")):s.value==1?(u(),d("div",Be,[a(ye,{title:"货物使用情况","legend-data":Y.value,"series-data":Z.value},null,8,["legend-data","series-data"])])):s.value==2&&n.value!=null?(u(),d("div",Ue,[t("div",{class:"sidebarbox",onClick:e[4]||(e[4]=l=>F(n.value.container.allbox,n.value.container.allmodules,n.value.container.gravityCenter))},[t("h2",null,"集装箱:"+o(n.value.container.name),1),e[10]||(e[10]=t("b",null,"模块总容积:",-1)),e[11]||(e[11]=t("br",null,null,-1)),v(o(n.value.container.volumn)+" 平方厘米 ",1),e[12]||(e[12]=t("br",null,null,-1)),e[13]||(e[13]=t("b",null,"货物体积:",-1)),e[14]||(e[14]=t("br",null,null,-1)),v(o(n.value.container.boxesvolumn)+" 平方厘米 ",1),e[15]||(e[15]=t("br",null,null,-1)),e[16]||(e[16]=t("b",null,"体积利用率:",-1)),v(o((n.value.container.volumnUR*100).toFixed(3))+"% ",1),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=t("b",null,"重心坐标:",-1)),e[19]||(e[19]=t("br",null,null,-1)),v(" x:"+o(h(n.value.container.gravityCenter)[0])+" y:"+o(h(n.value.container.gravityCenter)[1])+" z:"+o(h(n.value.container.gravityCenter)[2])+" ",1),e[20]||(e[20]=t("br",null,null,-1)),e[21]||(e[21]=t("b",null,"中心坐标:",-1)),e[22]||(e[22]=t("br",null,null,-1)),v(" x:"+o(h(_.value)[0])+" y:"+o(h(_.value)[1])+" z:"+o(h(_.value)[2])+" ",1),e[23]||(e[23]=t("br",null,null,-1)),e[24]||(e[24]=t("b",null,"相对中心偏移:",-1)),e[25]||(e[25]=t("br",null,null,-1)),v(" x:"+o((_.value[0]-n.value.container.gravityCenter[0]).toFixed(3))+" y:"+o((_.value[1]-n.value.container.gravityCenter[1]).toFixed(3))+" z:"+o((_.value[2]-n.value.container.gravityCenter[2]).toFixed(3))+" ",1),(u(!0),d(B,null,U(n.value.container.restBoxnum,(l,m)=>(u(),d("div",{class:"hw",key:m},[l?(u(),d("div",$e,o(g(w)[g(k).boxes[m].id].name)+" 剩余数量为 "+o(n.value.container.restBoxnum[m]),1)):O("",!0)]))),128)),e[26]||(e[26]=t("br",null,null,-1)),t("button",{onClick:e[3]||(e[3]=l=>F(n.value.container.allbox,n.value.container.allmodules,n.value.container.gravityCenter))},"3D")]),(u(!0),d(B,null,U(n.value.modules,(l,m)=>(u(),d("div",{class:"sidebarbox",key:`module_${l.name}_${m}`,onClick:L=>F(l.boxes,[l.showModule],l.gravityCenter)},[t("h4",null,"模块:"+o(l.name),1),e[27]||(e[27]=t("b",null,"模块容积:",-1)),v(o(l.volumn)+" 平方厘米 ",1),e[28]||(e[28]=t("br",null,null,-1)),e[29]||(e[29]=t("b",null,"货物体积:",-1)),v(o(l.boxesvolumn)+" 平方厘米 ",1),e[30]||(e[30]=t("br",null,null,-1)),e[31]||(e[31]=t("b",null,"体积利用率:",-1)),v(o((l.volumnUR*100).toFixed(3))+"% ",1),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=t("b",null,"重心坐标:",-1)),v(o(h(l.gravityCenter))+" ",1),(u(!0),d(B,null,U(l.num_list,(L,G)=>(u(),d("div",{class:"hw",key:`hw_${l.name}_${G}`},[L?(u(),d("div",Fe,o(g(w)[g(k).boxes[G].id].name)+" 数量为 "+o(l.num_list[G]),1)):O("",!0)]))),128)),(u(),d("button",{key:`module_${l.name}`,onClick:L=>F(l.boxes,[l.showModule],l.gravityCenter)},"3D",8,Le))],8,Ae))),128))])):O("",!0)]),_:1}),t("div",Ne,[a(ue,{gutter:20,align:"middle"},{default:i(()=>[a(H,{span:8},{default:i(()=>[a(Q,{type:"primary",plain:"",onClick:le,style:{width:"100%"}},{default:i(()=>e[34]||(e[34]=[v(" 上一步 ")])),_:1})]),_:1}),a(H,{span:16},{default:i(()=>[a(Q,{type:"primary",plain:"",onClick:ee,style:{width:"100%"}},{default:i(()=>e[35]||(e[35]=[v(" 下一步 ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Ge=fe(De,[["__scopeId","data-v-9dd38e15"]]);export{Ge as default};
