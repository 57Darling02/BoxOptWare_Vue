import{u as de}from"./Container-B9kWBGXR.js";import{_ as ve}from"./tres3dprop.vue_vue_type_style_index_0_lang-D4RO86zl.js";import{d as me,B as K,x as T,r as _,y as ce,f as pe,q as W,j as i,m as b,b as s,c as d,s as z,a as t,F as B,p as E,e as f,h as v,t as a,E as be,l as X,o as r,_ as fe}from"./index-v_keKozW.js";import{E as ye}from"./EChartsPie-aI1bO5jv.js";import{u as xe}from"./Box-RbR8uNKV.js";const ge=Y=>new Promise((O,V)=>{const y=new Worker(new URL("/assets/block.worker-Bps2oAeU.js",import.meta.url),{type:"module"});y.onmessage=u=>{u.data.type==="SUCCESS"?(O(u.data.data),y.terminate()):(V(new Error(u.data.error)),y.terminate())},y.postMessage({type:"CALCULATE",data:JSON.parse(JSON.stringify(Y))})}),_e={key:0,class:"show"},we={class:"containerstep"},ke={class:"boxstep"},Ce={key:1,class:"show"},Ve={class:"carbox"},Se={class:"carbox"},he={key:2,class:"show"},ze={class:"sidebarbox"},Be={key:0,class:"sidebarbox"},Ee={key:1,class:"sidebarbox",style:{height:"500px"}},Ue={key:2},Ae={key:0,class:"hw2"},$e=["onClick"],Fe={key:0,class:"hw2"},Le=["onClick"],Ne={style:{padding:"12px","border-top":"1px solid var(--el-border-color)"}},Me=me({__name:"mainWorkPage",setup(Y){const O=de(),{container_list:V}=K(O),y=T(()=>{if(!o.value||!o.value.container||!o.value.container.allmodules)return[0,0,0];let n=0,e=0,m=0;const c=[...o.value.container.allmodules];for(const j of c){const[N,M,R]=j.centerPosition;n+=N,e+=M,m+=R}const C=c.length,D=n/C,k=e/C,P=m/C;return[D,k,P]}),u=_(0),o=_(),S=n=>n.map(e=>e.toFixed(1)),Q=()=>{if(++u.value>2){u.value=2;return}u.value==0?console.log(u.value):u.value==1?(console.log(u.value),ae()):u.value==2&&(async()=>{const n=be.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{o.value=await ge(g),$(o.value.container.allbox,o.value.container.allmodules,o.value.container.gravityCenter)}catch(e){console.log("计算失败",e)}finally{n.close()}})()},ee=()=>{if(--u.value<0){u.value=0;return}},le=xe(),{Box_list:x}=K(le),L=_(!1),U=_(!1),w=_([]),A=_([]),h=_(0);ce(w,n=>{n.length===0?(L.value=!1,U.value=!1):n.length===x.value.length?(L.value=!0,U.value=!1):U.value=!0,A.value=new Array(n.length).fill(1),console.log("Selected  goods:",w.value)});const te=n=>{U.value=!1,n?(w.value=x.value.map((e,m)=>m),console.log("All  goods selected")):(w.value=[],console.log("All  goods deselected"))};let g=pe({name:V.value[h.value].name,containers:[],boxes:[],num_list:[]});const ne=T(()=>{const n=new Set;return g.boxes.forEach(e=>{n.add(x.value[e.id].name)}),Array.from(n)}),oe=T(()=>{const n=new Map;return g.boxes.forEach((e,m)=>{const c=x.value[e.id].name,C=g.num_list[m];n.has(c)?n.set(c,n.get(c)+C):n.set(c,C)}),Array.from(n.entries()).map(([e,m])=>({value:m,name:e}))});function ae(){if(w.value.length<=0){X({message:"请选择货物"}),u.value=0;return}else if(w.value.length!==A.value.length){X({message:"货物数量异常"}),u.value=0;return}else if(h.value<0||h.value>=V.value.length){X({message:"请选择集装箱"}),u.value=1;return}const n=V.value[h.value],e=n.module;e.length==0&&e.push({lx:n.lx,ly:n.ly,lz:n.lz,name:n.name,x:0,y:0,z:0}),g={name:V.value[h.value].name,containers:e,boxes:[],num_list:A.value};for(const m of w.value){const c=x.value[m];g.boxes.push({lx:c.lx,ly:c.ly,lz:c.lz,id:m,mass:c.mass})}}const se=_([]),Z=_([]),q=_([]),J=_([0,0,0]);function $(n=[],e=[],m){Z.value=e,J.value=m,q.value=n}return(n,e)=>{const m=b("el-option"),c=b("el-select"),C=b("el-checkbox"),D=b("el-input-number"),k=b("el-table-column"),P=b("el-table"),j=b("el-main"),N=b("el-container"),M=b("el-step"),R=b("el-steps"),ue=b("el-scrollbar"),I=b("el-button"),H=b("el-col"),re=b("el-row"),ie=b("el-aside");return r(),W(N,{class:"layout-container",style:{height:"100%"}},{default:i(()=>[s(N,null,{default:i(()=>[s(j,null,{default:i(()=>[u.value==0?(r(),d("div",_e,[e[6]||(e[6]=t("h1",null,"- 选择集装箱",-1)),t("div",we,[s(c,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),placeholder:"Select",size:"large",style:{width:"240px"}},{default:i(()=>[(r(!0),d(B,null,E(f(V),(l,p)=>(r(),W(m,{key:l.name,label:l.name,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e[7]||(e[7]=t("h1",null,"- 选择货物种类及数量",-1)),s(c,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),multiple:"",clearable:"","collapse-tags":"",placeholder:"Select goods","popper-class":"custom-header","max-collapse-tags":1,style:{width:"240px"}},{header:i(()=>[s(C,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=l=>L.value=l),indeterminate:U.value,onChange:te},{default:i(()=>e[5]||(e[5]=[v(" 全选 ")])),_:1},8,["modelValue","indeterminate"])]),default:i(()=>[(r(!0),d(B,null,E(f(x),(l,p)=>(r(),W(m,{key:p,label:l.name,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(r(!0),d(B,null,E(w.value,(l,p)=>(r(),d("div",ke,[v(" 货物 "+a(f(x)[l].name)+" 数量为 ",1),s(D,{min:1,modelValue:A.value[p],"onUpdate:modelValue":F=>A.value[p]=F},null,8,["modelValue","onUpdate:modelValue"])]))),256))])):u.value==1?(r(),d("div",Ce,[e[9]||(e[9]=t("h2",null,"最终确认",-1)),t("div",Ve," 集装箱："+a(f(g).name),1),t("div",Se,[e[8]||(e[8]=t("h3",null,"货物清单",-1)),s(P,{data:f(g).boxes,stripe:"",style:{width:"100%"}},{default:i(()=>[s(k,{prop:"id",label:"编号",width:"auto"}),s(k,{label:"货物名称",width:"auto"},{default:i(({row:l})=>[v(a(f(x)[l.id].name),1)]),_:1}),s(k,{prop:"lx",label:"长",width:"auto"}),s(k,{prop:"ly",label:"宽",width:"auto"}),s(k,{prop:"lz",label:"高",width:"auto"}),s(k,{label:"数量",width:"auto"},{default:i(({row:l,$index:p})=>[v(a(f(g).num_list[p]),1)]),_:1}),s(k,{label:"货物质量",width:"auto"},{default:i(({row:l})=>[v(a(f(x)[l.id].mass),1)]),_:1})]),_:1},8,["data"])])])):u.value==2?(r(),d("div",he,[s(ve,{main_containers:se.value,module_containers:Z.value,boxes:q.value,centerOfGravity:J.value},null,8,["main_containers","module_containers","boxes","centerOfGravity"])])):z("",!0)]),_:1})]),_:1}),s(ie,{"max-width":"25%",style:{display:"flex","flex-direction":"column"}},{default:i(()=>[s(ue,null,{default:i(()=>[t("div",ze,[s(R,{style:{"max-width":"600px"},active:u.value,"finish-status":"success","align-center":""},{default:i(()=>[s(M),s(M)]),_:1},8,["active"])]),u.value==0?(r(),d("div",Be," - 选择集装箱、货物种类及数量 ")):z("",!0),u.value==1?(r(),d("div",Ee,[s(ye,{title:"货物使用情况","legend-data":ne.value,"series-data":oe.value},null,8,["legend-data","series-data"])])):z("",!0),u.value==2&&o.value!=null?(r(),d("div",Ue,[t("div",{class:"sidebarbox",onClick:e[4]||(e[4]=l=>$(o.value.container.allbox,o.value.container.allmodules,o.value.container.gravityCenter))},[t("h2",null,"集装箱:"+a(o.value.container.name),1),e[10]||(e[10]=t("b",null,"模块总容积:",-1)),e[11]||(e[11]=t("br",null,null,-1)),v(a(o.value.container.volumn)+" 平方厘米 ",1),e[12]||(e[12]=t("br",null,null,-1)),e[13]||(e[13]=t("b",null,"货物体积:",-1)),e[14]||(e[14]=t("br",null,null,-1)),v(a(o.value.container.boxesvolumn)+" 平方厘米 ",1),e[15]||(e[15]=t("br",null,null,-1)),e[16]||(e[16]=t("b",null,"体积利用率:",-1)),v(a((o.value.container.volumnUR*100).toFixed(3))+"% ",1),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=t("b",null,"重心坐标:",-1)),e[19]||(e[19]=t("br",null,null,-1)),v(" x:"+a(S(o.value.container.gravityCenter)[0])+" y:"+a(S(o.value.container.gravityCenter)[1])+" z:"+a(S(o.value.container.gravityCenter)[2])+" ",1),e[20]||(e[20]=t("br",null,null,-1)),e[21]||(e[21]=t("b",null,"中心坐标:",-1)),e[22]||(e[22]=t("br",null,null,-1)),v(" x:"+a(S(y.value)[0])+" y:"+a(S(y.value)[1])+" z:"+a(S(y.value)[2])+" ",1),e[23]||(e[23]=t("br",null,null,-1)),e[24]||(e[24]=t("b",null,"相对中心偏移:",-1)),e[25]||(e[25]=t("br",null,null,-1)),v(" x:"+a((y.value[0]-o.value.container.gravityCenter[0]).toFixed(3))+" y:"+a((y.value[1]-o.value.container.gravityCenter[1]).toFixed(3))+" z:"+a((y.value[2]-o.value.container.gravityCenter[2]).toFixed(3))+" ",1),(r(!0),d(B,null,E(o.value.container.restBoxnum,(l,p)=>(r(),d("div",{class:"hw",key:p},[l?(r(),d("div",Ae,a(f(x)[f(g).boxes[p].id].name)+" 剩余数量为 "+a(o.value.container.restBoxnum[p]),1)):z("",!0)]))),128)),e[26]||(e[26]=t("br",null,null,-1)),t("button",{onClick:e[3]||(e[3]=l=>$(o.value.container.allbox,o.value.container.allmodules,o.value.container.gravityCenter))},"3D")]),(r(!0),d(B,null,E(o.value.modules,(l,p)=>(r(),d("div",{class:"sidebarbox",key:`module_${l.name}_${p}`,onClick:F=>$(l.boxes,[l.showModule],l.gravityCenter)},[t("h4",null,"模块:"+a(l.name),1),e[27]||(e[27]=t("b",null,"模块容积:",-1)),v(a(l.volumn)+" 平方厘米 ",1),e[28]||(e[28]=t("br",null,null,-1)),e[29]||(e[29]=t("b",null,"货物体积:",-1)),v(a(l.boxesvolumn)+" 平方厘米 ",1),e[30]||(e[30]=t("br",null,null,-1)),e[31]||(e[31]=t("b",null,"体积利用率:",-1)),v(a((l.volumnUR*100).toFixed(3))+"% ",1),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=t("b",null,"重心坐标:",-1)),v(a(S(l.gravityCenter))+" ",1),(r(!0),d(B,null,E(l.num_list,(F,G)=>(r(),d("div",{class:"hw",key:`hw_${l.name}_${G}`},[F?(r(),d("div",Fe,a(f(x)[f(g).boxes[G].id].name)+" 数量为 "+a(l.num_list[G]),1)):z("",!0)]))),128)),(r(),d("button",{key:`module_${l.name}`,onClick:F=>$(l.boxes,[l.showModule],l.gravityCenter)},"3D",8,Le))],8,$e))),128))])):z("",!0)]),_:1}),t("div",Ne,[s(re,{gutter:20,align:"middle"},{default:i(()=>[s(H,{span:8},{default:i(()=>[s(I,{type:"primary",plain:"",onClick:ee,style:{width:"100%"}},{default:i(()=>e[34]||(e[34]=[v(" 上一步 ")])),_:1})]),_:1}),s(H,{span:16},{default:i(()=>[s(I,{type:"primary",plain:"",onClick:Q,style:{width:"100%"}},{default:i(()=>e[35]||(e[35]=[v(" 下一步 ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Ge=fe(Me,[["__scopeId","data-v-c9aea3a6"]]);export{Ge as default};
