import{u as ve}from"./Container-DF6pbgg5.js";import{_ as me}from"./tres3dprop.vue_vue_type_style_index_0_lang-C-WO4DL_.js";import{d as ce,r as f,B as ee,x as pe,y as be,f as fe,q as G,j as d,m,b as o,c as i,s as M,a as t,F as E,p as U,e as _,h as v,t as a,E as xe,l as T,o as s,_ as ye}from"./index-BHKU1jEy.js";import{E as _e}from"./EChartsPie-CF5OJufo.js";import{u as ge}from"./Box-bRXYW36G.js";const we=W=>new Promise(($,j)=>{const C=new Worker(new URL("/assets/block.worker-Bf4PYXx9.js",import.meta.url),{type:"module"});C.onmessage=V=>{V.data.type==="SUCCESS"?($(V.data.data),C.terminate()):(j(new Error(V.data.error)),C.terminate())},C.postMessage({type:"CALCULATE",data:JSON.parse(JSON.stringify(W))})}),ke={key:0,class:"show"},Ce={class:"containerstep"},Ve={class:"boxstep"},Se={key:1,class:"show"},he={class:"carbox"},ze={class:"carbox"},Be={key:2,class:"show"},Ee={class:"sidebarbox"},Ue={key:0,class:"sidebarbox"},$e={key:1,class:"sidebarbox"},Ae={key:2,class:"sidebarbox",style:{height:"500px"}},Fe={key:3},Le={key:0,class:"hw2"},Ne=["onClick"],Me={key:0,class:"hw2"},Oe=["onClick"],Pe={style:{padding:"12px","border-top":"1px solid var(--el-border-color)"}},De=ce({__name:"mainWorkPage",setup(W){const $=f(!0),j=ve(),{container_list:C}=ee(j),V=pe(()=>{if(!n.value||!n.value.container||!n.value.container.allmodules)return[0,0,0];let u=0,e=0,x=0;const k=[...n.value.container.allmodules];for(const R of k){const[P,D,X]=R.centerPosition;u+=P,e+=D,x+=X}const p=k.length,y=u/p,b=e/p,B=x/p;return[y,b,B]}),r=f(0),n=f(),h=u=>u.map(e=>e.toFixed(1)),le=()=>{if(++r.value>2){r.value=2;return}r.value==0?console.log(r.value):r.value==1?(console.log(r.value),ae()):r.value==2&&(async()=>{const u=xe.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{n.value=await we(w),L(n.value.container.allbox,n.value.container.allmodules,n.value.container.gravityCenter)}catch(e){console.log("计算失败",e)}finally{u.close()}})()},te=()=>{if(--r.value<0){r.value=0;return}},ne=ge(),{Box_list:g}=ee(ne),O=f(!1),A=f(!1),S=f([]),F=f([]),z=f(0);be(S,u=>{u.length===0?(O.value=!1,A.value=!1):u.length===g.value.length?(O.value=!0,A.value=!1):A.value=!0,F.value=new Array(u.length).fill(1),console.log("Selected  goods:",S.value)});const oe=u=>{A.value=!1,u?(S.value=g.value.map((e,x)=>x),console.log("All  goods selected")):(S.value=[],console.log("All  goods deselected"))};let w=fe({name:C.value[z.value].name,containers:[],boxes:[],num_list:[]});const Z=f(),q=f();function ae(){if(S.value.length<=0){T({message:"请选择货物"}),r.value=0;return}else if(S.value.length!==F.value.length){T({message:"货物数量异常"}),r.value=0;return}else if(z.value<0||z.value>=C.value.length){T({message:"请选择集装箱"}),r.value=1;return}const u=C.value[z.value],e=u.module;e.length==0&&e.push({lx:u.lx,ly:u.ly,lz:u.lz,name:u.name,x:0,y:0,z:0}),w={name:C.value[z.value].name,containers:e,boxes:[],num_list:F.value};for(const p of S.value){const y=g.value[p];w.boxes.push({lx:y.lx,ly:y.ly,lz:y.lz,id:p,mass:y.mass})}const x=new Set;w.boxes.forEach(p=>{x.add(g.value[p.id].name)});const k=new Map;w.boxes.forEach((p,y)=>{const b=g.value[p.id].name,B=w.num_list[y];k.has(b)?k.set(b,k.get(b)+B):k.set(b,B)}),Z.value=Array.from(x),q.value=Array.from(k.entries()).map(([p,y])=>({value:y,name:p}))}const se=f([]),J=f([]),I=f([]),H=f([0,0,0]);function L(u=[],e=[],x){J.value=e,H.value=x,I.value=u}return(u,e)=>{const x=m("el-option"),k=m("el-select"),p=m("el-checkbox"),y=m("el-input-number"),b=m("el-table-column"),B=m("el-table"),R=m("el-main"),P=m("el-container"),D=m("el-step"),X=m("el-steps"),ue=m("el-switch"),re=m("el-scrollbar"),K=m("el-button"),Q=m("el-col"),ie=m("el-row"),de=m("el-aside");return s(),G(P,{class:"layout-container",style:{height:"100%"}},{default:d(()=>[o(P,null,{default:d(()=>[o(R,null,{default:d(()=>[r.value==0?(s(),i("div",ke,[e[7]||(e[7]=t("h1",null,"- 选择集装箱",-1)),t("div",Ce,[o(k,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=l=>z.value=l),placeholder:"Select",size:"large",style:{width:"240px"}},{default:d(()=>[(s(!0),i(E,null,U(_(C),(l,c)=>(s(),G(x,{key:l.name,label:l.name,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e[8]||(e[8]=t("h1",null,"- 选择货物种类及数量",-1)),o(k,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=l=>S.value=l),multiple:"",clearable:"","collapse-tags":"",placeholder:"Select goods","popper-class":"custom-header","max-collapse-tags":1,style:{width:"240px"}},{header:d(()=>[o(p,{modelValue:O.value,"onUpdate:modelValue":e[1]||(e[1]=l=>O.value=l),indeterminate:A.value,onChange:oe},{default:d(()=>e[6]||(e[6]=[v(" 全选 ")])),_:1},8,["modelValue","indeterminate"])]),default:d(()=>[(s(!0),i(E,null,U(_(g),(l,c)=>(s(),G(x,{key:c,label:l.name,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(s(!0),i(E,null,U(S.value,(l,c)=>(s(),i("div",Ve,[v(" 货物 "+a(_(g)[l].name)+" 数量为 ",1),o(y,{min:1,modelValue:F.value[c],"onUpdate:modelValue":N=>F.value[c]=N},null,8,["modelValue","onUpdate:modelValue"])]))),256))])):r.value==1?(s(),i("div",Se,[e[10]||(e[10]=t("h2",null,"最终确认",-1)),t("div",he," 集装箱："+a(_(w).name),1),t("div",ze,[e[9]||(e[9]=t("h3",null,"货物清单",-1)),o(B,{data:_(w).boxes,stripe:"",style:{width:"100%"}},{default:d(()=>[o(b,{prop:"id",label:"编号",width:"auto"}),o(b,{label:"货物名称",width:"auto"},{default:d(({row:l})=>[v(a(_(g)[l.id].name),1)]),_:1}),o(b,{prop:"lx",label:"长",width:"auto"}),o(b,{prop:"ly",label:"宽",width:"auto"}),o(b,{prop:"lz",label:"高",width:"auto"}),o(b,{label:"数量",width:"auto"},{default:d(({row:l,$index:c})=>[v(a(_(w).num_list[c]),1)]),_:1}),o(b,{label:"货物质量",width:"auto"},{default:d(({row:l})=>[v(a(_(g)[l.id].mass),1)]),_:1})]),_:1},8,["data"])])])):r.value==2?(s(),i("div",Be,[o(me,{main_containers:se.value,module_containers:J.value,boxes:I.value,outline:$.value,centerOfGravity:H.value},null,8,["main_containers","module_containers","boxes","outline","centerOfGravity"])])):M("",!0)]),_:1})]),_:1}),o(de,{"max-width":"25%",style:{display:"flex","flex-direction":"column"}},{default:d(()=>[o(re,null,{default:d(()=>[t("div",Ee,[o(X,{style:{"max-width":"600px"},active:r.value,"finish-status":"success","align-center":""},{default:d(()=>[o(D),o(D)]),_:1},8,["active"])]),r.value==2?(s(),i("div",Ue,[o(ue,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=l=>$.value=l),class:"mb-2","active-text":"描边","inactive-text":"不描边","align-center":""},null,8,["modelValue"])])):M("",!0),r.value==0?(s(),i("div",$e," - 选择集装箱、货物种类及数量 ")):r.value==1?(s(),i("div",Ae,[o(_e,{title:"货物使用情况","legend-data":Z.value,"series-data":q.value},null,8,["legend-data","series-data"])])):r.value==2&&n.value!=null?(s(),i("div",Fe,[t("div",{class:"sidebarbox",onClick:e[5]||(e[5]=l=>L(n.value.container.allbox,n.value.container.allmodules,n.value.container.gravityCenter))},[t("h2",null,"集装箱:"+a(n.value.container.name),1),e[11]||(e[11]=t("b",null,"模块总容积:",-1)),e[12]||(e[12]=t("br",null,null,-1)),v(a(n.value.container.volumn)+" 平方厘米 ",1),e[13]||(e[13]=t("br",null,null,-1)),e[14]||(e[14]=t("b",null,"货物体积:",-1)),e[15]||(e[15]=t("br",null,null,-1)),v(a(n.value.container.boxesvolumn)+" 平方厘米 ",1),e[16]||(e[16]=t("br",null,null,-1)),e[17]||(e[17]=t("b",null,"体积利用率:",-1)),v(a((n.value.container.volumnUR*100).toFixed(3))+"% ",1),e[18]||(e[18]=t("br",null,null,-1)),e[19]||(e[19]=t("b",null,"重心坐标:",-1)),e[20]||(e[20]=t("br",null,null,-1)),v(" x:"+a(h(n.value.container.gravityCenter)[0])+" y:"+a(h(n.value.container.gravityCenter)[1])+" z:"+a(h(n.value.container.gravityCenter)[2])+" ",1),e[21]||(e[21]=t("br",null,null,-1)),e[22]||(e[22]=t("b",null,"中心坐标:",-1)),e[23]||(e[23]=t("br",null,null,-1)),v(" x:"+a(h(V.value)[0])+" y:"+a(h(V.value)[1])+" z:"+a(h(V.value)[2])+" ",1),e[24]||(e[24]=t("br",null,null,-1)),e[25]||(e[25]=t("b",null,"相对中心偏移:",-1)),e[26]||(e[26]=t("br",null,null,-1)),v(" x:"+a((V.value[0]-n.value.container.gravityCenter[0]).toFixed(3))+" y:"+a((V.value[1]-n.value.container.gravityCenter[1]).toFixed(3))+" z:"+a((V.value[2]-n.value.container.gravityCenter[2]).toFixed(3))+" ",1),(s(!0),i(E,null,U(n.value.container.restBoxnum,(l,c)=>(s(),i("div",{class:"hw",key:c},[l?(s(),i("div",Le,a(_(g)[_(w).boxes[c].id].name)+" 剩余数量为 "+a(n.value.container.restBoxnum[c]),1)):M("",!0)]))),128)),e[27]||(e[27]=t("br",null,null,-1)),t("button",{onClick:e[4]||(e[4]=l=>L(n.value.container.allbox,n.value.container.allmodules,n.value.container.gravityCenter))},"3D")]),(s(!0),i(E,null,U(n.value.modules,(l,c)=>(s(),i("div",{class:"sidebarbox",key:`module_${l.name}_${c}`,onClick:N=>L(l.boxes,[l.showModule],l.gravityCenter)},[t("h4",null,"模块:"+a(l.name),1),e[28]||(e[28]=t("b",null,"模块容积:",-1)),v(a(l.volumn)+" 平方厘米 ",1),e[29]||(e[29]=t("br",null,null,-1)),e[30]||(e[30]=t("b",null,"货物体积:",-1)),v(a(l.boxesvolumn)+" 平方厘米 ",1),e[31]||(e[31]=t("br",null,null,-1)),e[32]||(e[32]=t("b",null,"体积利用率:",-1)),v(a((l.volumnUR*100).toFixed(3))+"% ",1),e[33]||(e[33]=t("br",null,null,-1)),e[34]||(e[34]=t("b",null,"重心坐标:",-1)),v(a(h(l.gravityCenter))+" ",1),(s(!0),i(E,null,U(l.num_list,(N,Y)=>(s(),i("div",{class:"hw",key:`hw_${l.name}_${Y}`},[N?(s(),i("div",Me,a(_(g)[_(w).boxes[Y].id].name)+" 数量为 "+a(l.num_list[Y]),1)):M("",!0)]))),128)),(s(),i("button",{key:`module_${l.name}`,onClick:N=>L(l.boxes,[l.showModule],l.gravityCenter)},"3D",8,Oe))],8,Ne))),128))])):M("",!0)]),_:1}),t("div",Pe,[o(ie,{gutter:20,align:"middle"},{default:d(()=>[o(Q,{span:8},{default:d(()=>[o(K,{type:"primary",plain:"",onClick:te,style:{width:"100%"}},{default:d(()=>e[35]||(e[35]=[v(" 上一步 ")])),_:1})]),_:1}),o(Q,{span:16},{default:d(()=>[o(K,{type:"primary",plain:"",onClick:le,style:{width:"100%"}},{default:d(()=>e[36]||(e[36]=[v(" 下一步 ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Te=ye(De,[["__scopeId","data-v-4f419a6d"]]);export{Te as default};
