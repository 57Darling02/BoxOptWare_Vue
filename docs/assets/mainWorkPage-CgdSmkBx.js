import{u as ve}from"./Container-DNPNB6SC.js";import{_ as me}from"./tres3dprop.vue_vue_type_style_index_0_lang-CumY4Apz.js";import{d as ce,r as f,D as ee,z as pe,A as be,i as fe,t as G,m as i,s as m,g as n,c as d,x as N,a as l,F as U,f as A,h as _,k as v,y as o,E as xe,q as T,o as s,_ as ye}from"./index-CLD_l2RJ.js";import{E as _e}from"./EChartsPie-CGIEd79v.js";import{u as ge}from"./Box-DiVvEv20.js";const we=W=>new Promise((B,D)=>{const C=new Worker(new URL("/assets/block.worker-Bf4PYXx9.js",import.meta.url),{type:"module"});C.onmessage=V=>{V.data.type==="SUCCESS"?(B(V.data.data),C.terminate()):(D(new Error(V.data.error)),C.terminate())},C.postMessage({type:"CALCULATE",data:JSON.parse(JSON.stringify(W))})}),ke={key:0,class:"show"},Ce={class:"containerstep"},Ve={class:"boxstep"},Se={key:1,class:"show"},he={class:"carbox"},ze={class:"carbox"},Ee={key:2,class:"show"},Ue={class:"sidebarbox"},Ae={key:0,class:"sidebarbox"},Be={key:1,class:"sidebarbox"},Fe={key:2,class:"sidebarbox",style:{height:"500px"}},Le={key:3},Ne={key:0,class:"hw2"},$e=["onClick"],Oe={key:0,class:"hw2"},Pe={style:{padding:"12px","border-top":"1px solid var(--el-border-color)"}},Me=ce({__name:"mainWorkPage",setup(W){const B=f(!0),D=ve(),{container_list:C}=ee(D),V=pe(()=>{if(!a.value||!a.value.container||!a.value.container.allmodules)return[0,0,0];let u=0,e=0,x=0;const k=[...a.value.container.allmodules];for(const X of k){const[O,P,Y]=X.centerPosition;u+=O,e+=P,x+=Y}const p=k.length,y=u/p,b=e/p,E=x/p;return[y,b,E]}),r=f(0),a=f(),h=u=>u.map(e=>e.toFixed(1)),le=()=>{if(++r.value>2){r.value=2;return}r.value==0?console.log(r.value):r.value==1?(console.log(r.value),ae()):r.value==2&&(async()=>{const u=xe.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{a.value=await we(w),R(a.value.container.allbox,a.value.container.allmodules,a.value.container.gravityCenter)}catch(e){console.log("计算失败",e)}finally{u.close()}})()},te=()=>{if(--r.value<0){r.value=0;return}},ne=ge(),{Box_list:g}=ee(ne),$=f(!1),F=f(!1),S=f([]),L=f([]),z=f(0);be(S,u=>{u.length===0?($.value=!1,F.value=!1):u.length===g.value.length?($.value=!0,F.value=!1):F.value=!0,L.value=new Array(u.length).fill(1),console.log("Selected  goods:",S.value)});const oe=u=>{F.value=!1,u?(S.value=g.value.map((e,x)=>x),console.log("All  goods selected")):(S.value=[],console.log("All  goods deselected"))};let w=fe({name:C.value[z.value].name,containers:[],boxes:[],num_list:[]});const Z=f(),q=f();function ae(){if(S.value.length<=0){T({message:"请选择货物"}),r.value=0;return}else if(S.value.length!==L.value.length){T({message:"货物数量异常"}),r.value=0;return}else if(z.value<0||z.value>=C.value.length){T({message:"请选择集装箱"}),r.value=1;return}const u=C.value[z.value],e=u.module;e.length==0&&e.push({lx:u.lx,ly:u.ly,lz:u.lz,name:u.name,x:0,y:0,z:0}),w={name:C.value[z.value].name,containers:e,boxes:[],num_list:L.value};for(const p of S.value){const y=g.value[p];w.boxes.push({lx:y.lx,ly:y.ly,lz:y.lz,id:p,mass:y.mass})}const x=new Set;w.boxes.forEach(p=>{x.add(g.value[p.id].name)});const k=new Map;w.boxes.forEach((p,y)=>{const b=g.value[p.id].name,E=w.num_list[y];k.has(b)?k.set(b,k.get(b)+E):k.set(b,E)}),Z.value=Array.from(x),q.value=Array.from(k.entries()).map(([p,y])=>({value:y,name:p}))}const se=f([]),J=f([]),I=f([]),H=f([0,0,0]);function R(u=[],e=[],x){J.value=e,H.value=x,I.value=u}return(u,e)=>{const x=m("el-option"),k=m("el-select"),p=m("el-checkbox"),y=m("el-input-number"),b=m("el-table-column"),E=m("el-table"),X=m("el-main"),O=m("el-container"),P=m("el-step"),Y=m("el-steps"),ue=m("el-switch"),re=m("el-scrollbar"),K=m("el-button"),Q=m("el-col"),ie=m("el-row"),de=m("el-aside");return s(),G(O,{class:"layout-container",style:{height:"100%"}},{default:i(()=>[n(O,null,{default:i(()=>[n(X,null,{default:i(()=>[r.value==0?(s(),d("div",ke,[e[6]||(e[6]=l("h1",null,"- 选择集装箱",-1)),l("div",Ce,[n(k,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=t=>z.value=t),placeholder:"Select",size:"large",style:{width:"240px"}},{default:i(()=>[(s(!0),d(U,null,A(_(C),(t,c)=>(s(),G(x,{key:t.name,label:t.name,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e[7]||(e[7]=l("h1",null,"- 选择货物种类及数量",-1)),n(k,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=t=>S.value=t),multiple:"",clearable:"","collapse-tags":"",placeholder:"Select goods","popper-class":"custom-header","max-collapse-tags":1,style:{width:"240px"}},{header:i(()=>[n(p,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=t=>$.value=t),indeterminate:F.value,onChange:oe},{default:i(()=>e[5]||(e[5]=[v(" 全选 ")])),_:1},8,["modelValue","indeterminate"])]),default:i(()=>[(s(!0),d(U,null,A(_(g),(t,c)=>(s(),G(x,{key:c,label:t.name,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(s(!0),d(U,null,A(S.value,(t,c)=>(s(),d("div",Ve,[v(" 货物 "+o(_(g)[t].name)+" 数量为 ",1),n(y,{min:1,modelValue:L.value[c],"onUpdate:modelValue":M=>L.value[c]=M},null,8,["modelValue","onUpdate:modelValue"])]))),256))])):r.value==1?(s(),d("div",Se,[e[9]||(e[9]=l("h2",null,"最终确认",-1)),l("div",he," 集装箱："+o(_(w).name),1),l("div",ze,[e[8]||(e[8]=l("h3",null,"货物清单",-1)),n(E,{data:_(w).boxes,stripe:"",style:{width:"100%"}},{default:i(()=>[n(b,{prop:"id",label:"编号",width:"auto"}),n(b,{label:"货物名称",width:"auto"},{default:i(({row:t})=>[v(o(_(g)[t.id].name),1)]),_:1}),n(b,{prop:"lx",label:"长",width:"auto"}),n(b,{prop:"ly",label:"宽",width:"auto"}),n(b,{prop:"lz",label:"高",width:"auto"}),n(b,{label:"数量",width:"auto"},{default:i(({row:t,$index:c})=>[v(o(_(w).num_list[c]),1)]),_:1}),n(b,{label:"货物质量",width:"auto"},{default:i(({row:t})=>[v(o(_(g)[t.id].mass),1)]),_:1})]),_:1},8,["data"])])])):r.value==2?(s(),d("div",Ee,[n(me,{main_containers:se.value,module_containers:J.value,boxes:I.value,outline:B.value,centerOfGravity:H.value},null,8,["main_containers","module_containers","boxes","outline","centerOfGravity"])])):N("",!0)]),_:1})]),_:1}),n(de,{"max-width":"25%",style:{display:"flex","flex-direction":"column"}},{default:i(()=>[n(re,null,{default:i(()=>[l("div",Ue,[n(Y,{style:{"max-width":"600px"},active:r.value,"finish-status":"success","align-center":""},{default:i(()=>[n(P),n(P)]),_:1},8,["active"])]),r.value==2?(s(),d("div",Ae,[n(ue,{modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=t=>B.value=t),class:"mb-2","active-text":"描边","inactive-text":"不描边","align-center":""},null,8,["modelValue"])])):N("",!0),r.value==0?(s(),d("div",Be," - 选择集装箱、货物种类及数量 ")):r.value==1?(s(),d("div",Fe,[n(_e,{title:"货物使用情况","legend-data":Z.value,"series-data":q.value},null,8,["legend-data","series-data"])])):r.value==2&&a.value!=null?(s(),d("div",Le,[l("div",{class:"sidebarbox",onClick:e[4]||(e[4]=t=>R(a.value.container.allbox,a.value.container.allmodules,a.value.container.gravityCenter))},[l("h2",null,"集装箱:"+o(a.value.container.name),1),e[10]||(e[10]=l("b",null,"模块总容积:",-1)),e[11]||(e[11]=l("br",null,null,-1)),v(o(a.value.container.volumn)+" 平方厘米 ",1),e[12]||(e[12]=l("br",null,null,-1)),e[13]||(e[13]=l("b",null,"货物体积:",-1)),e[14]||(e[14]=l("br",null,null,-1)),v(o(a.value.container.boxesvolumn)+" 平方厘米 ",1),e[15]||(e[15]=l("br",null,null,-1)),e[16]||(e[16]=l("b",null,"体积利用率:",-1)),v(o((a.value.container.volumnUR*100).toFixed(3))+"% ",1),e[17]||(e[17]=l("br",null,null,-1)),e[18]||(e[18]=l("b",null,"重心坐标:",-1)),e[19]||(e[19]=l("br",null,null,-1)),v(" x:"+o(h(a.value.container.gravityCenter)[0])+" y:"+o(h(a.value.container.gravityCenter)[1])+" z:"+o(h(a.value.container.gravityCenter)[2])+" ",1),e[20]||(e[20]=l("br",null,null,-1)),e[21]||(e[21]=l("b",null,"中心坐标:",-1)),e[22]||(e[22]=l("br",null,null,-1)),v(" x:"+o(h(V.value)[0])+" y:"+o(h(V.value)[1])+" z:"+o(h(V.value)[2])+" ",1),e[23]||(e[23]=l("br",null,null,-1)),e[24]||(e[24]=l("b",null,"相对中心偏移:",-1)),e[25]||(e[25]=l("br",null,null,-1)),v(" x:"+o((V.value[0]-a.value.container.gravityCenter[0]).toFixed(3))+" y:"+o((V.value[1]-a.value.container.gravityCenter[1]).toFixed(3))+" z:"+o((V.value[2]-a.value.container.gravityCenter[2]).toFixed(3))+" ",1),(s(!0),d(U,null,A(a.value.container.restBoxnum,(t,c)=>(s(),d("div",{class:"hw",key:c},[t?(s(),d("div",Ne,o(_(g)[_(w).boxes[c].id].name)+" 剩余数量为 "+o(a.value.container.restBoxnum[c]),1)):N("",!0)]))),128)),e[26]||(e[26]=l("br",null,null,-1))]),(s(!0),d(U,null,A(a.value.modules,(t,c)=>(s(),d("div",{class:"sidebarbox",key:`module_${t.name}_${c}`,onClick:M=>R(t.boxes,[t.showModule],t.gravityCenter)},[l("h4",null,"模块:"+o(t.name),1),e[27]||(e[27]=l("b",null,"模块容积:",-1)),v(o(t.volumn)+" 平方厘米 ",1),e[28]||(e[28]=l("br",null,null,-1)),e[29]||(e[29]=l("b",null,"货物体积:",-1)),v(o(t.boxesvolumn)+" 平方厘米 ",1),e[30]||(e[30]=l("br",null,null,-1)),e[31]||(e[31]=l("b",null,"体积利用率:",-1)),v(o((t.volumnUR*100).toFixed(3))+"% ",1),e[32]||(e[32]=l("br",null,null,-1)),e[33]||(e[33]=l("b",null,"重心坐标:",-1)),v(o(h(t.gravityCenter))+" ",1),(s(!0),d(U,null,A(t.num_list,(M,j)=>(s(),d("div",{class:"hw",key:`hw_${t.name}_${j}`},[M?(s(),d("div",Oe,o(_(g)[_(w).boxes[j].id].name)+" 数量为 "+o(t.num_list[j]),1)):N("",!0)]))),128))],8,$e))),128))])):N("",!0)]),_:1}),l("div",Pe,[n(ie,{gutter:20,align:"middle"},{default:i(()=>[n(Q,{span:8},{default:i(()=>[n(K,{type:"primary",plain:"",onClick:te,style:{width:"100%"}},{default:i(()=>e[34]||(e[34]=[v(" 上一步 ")])),_:1})]),_:1}),n(Q,{span:16},{default:i(()=>[n(K,{type:"primary",plain:"",onClick:le,style:{width:"100%"}},{default:i(()=>e[35]||(e[35]=[v(" 下一步 ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Ge=ye(Me,[["__scopeId","data-v-f09d14ad"]]);export{Ge as default};
