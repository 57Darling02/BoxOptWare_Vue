import{u as ve}from"./Container-ptyWnyxD.js";import{_ as me}from"./tres3dprop.vue_vue_type_style_index_0_lang-C6_IsXFX.js";import{d as ce,B as Q,x as q,r as S,y as pe,f as L,q as G,j as d,m as b,b as s,c as v,s as E,a as t,F as z,p as B,e as f,h as c,t as a,E as be,l as J,o as r,_ as fe}from"./index-D40j2aXo.js";import{E as xe}from"./EChartsPie-k48U8WSv.js";import{u as ye}from"./Box-DYl09e9D.js";const ge=I=>new Promise((R,C)=>{const x=new Worker(new URL("/assets/block.worker-Bps2oAeU.js",import.meta.url),{type:"module"});x.onmessage=u=>{u.data.type==="SUCCESS"?(R(u.data.data),x.terminate()):(C(new Error(u.data.error)),x.terminate())},x.postMessage({type:"CALCULATE",data:JSON.parse(JSON.stringify(I))})}),_e={key:0,class:"show"},we={class:"containerstep"},ke={class:"boxstep"},Ce={key:1,class:"show"},he={class:"carbox"},Ve={class:"carbox"},Se={key:2,class:"show"},Ee={class:"sidebarbox"},ze={key:0,class:"sidebarbox"},Be={key:1,class:"sidebarbox",style:{height:"500px"}},Ue={key:2},Ae={key:0,class:"hw2"},$e=["onClick"],Fe={key:0,class:"hw2"},Le=["onClick"],Ne={style:{padding:"12px","border-top":"1px solid var(--el-border-color)"}},Me=ce({__name:"mainWorkPage",setup(I){const R=ve(),{container_list:C}=Q(R),x=q(()=>{if(!o.value||!o.value.container||!o.value.container.allmodules)return[0,0,0];let n=0,e=0,m=0;const i=[...o.value.container.allmodules];for(const X of i){const[P,j,Y]=X.centerPosition;n+=P,e+=j,m+=Y}const k=i.length,T=n/k,w=e/k,W=m/k;return[T,w,W]}),u=S(0),o=S(),h=n=>n.map(e=>e.toFixed(1)),ee=()=>{if(++u.value>2){u.value=2;return}u.value==0?console.log(u.value):u.value==1?(console.log(u.value),se()):u.value==2&&(async()=>{const n=be.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{o.value=await ge(g),$(o.value.container.allbox,o.value.container.allmodules,o.value.container.gravityCenter)}catch(e){console.log("计算失败",e)}finally{n.close()}})()},le=()=>{if(--u.value<0){u.value=0;return}},te=ye(),{Box_list:y}=Q(te),N=S(!1),U=S(!1),_=S([]),A=S([]),V=S(0);pe(_,n=>{n.length===0?(N.value=!1,U.value=!1):n.length===y.value.length?(N.value=!0,U.value=!1):U.value=!0,A.value=new Array(n.length).fill(1),console.log("Selected  goods:",_.value)});const ne=n=>{U.value=!1,n?(_.value=y.value.map((e,m)=>m),console.log("All  goods selected")):(_.value=[],console.log("All  goods deselected"))};let g=L({name:C.value[V.value].name,containers:[],boxes:[],num_list:[]});const oe=q(()=>{const n=new Set;return g.boxes.forEach(e=>{n.add(y.value[e.id].name)}),Array.from(n)}),ae=q(()=>{const n=new Map;return g.boxes.forEach((e,m)=>{const i=y.value[e.id].name,k=g.num_list[m];n.has(i)?n.set(i,n.get(i)+k):n.set(i,k)}),Array.from(n.entries()).map(([e,m])=>({value:m,name:e}))});function se(){if(_.value.length<=0){J({message:"请选择货物"}),u.value=0;return}else if(_.value.length!==A.value.length){J({message:"货物数量异常"}),u.value=0;return}else if(V.value<0||V.value>=C.value.length){J({message:"请选择集装箱"}),u.value=1;return}const n=C.value[V.value],e=n.module;e.length==0&&e.push({lx:n.lx,ly:n.ly,lz:n.lz,name:n.name,x:0,y:0,z:0}),g={name:C.value[V.value].name,containers:e,boxes:[],num_list:A.value};for(const m of _.value){const i=y.value[m];g.boxes.push({lx:i.lx,ly:i.ly,lz:i.lz,id:m,mass:i.mass})}}const ue=L([]),M=L([]),D=L([]),O=L([0,0,0]);function $(n=[],e=[],m){D.splice(0,D.length),M.splice(0,M.length),n.forEach(i=>D.push(i)),e.forEach(i=>M.push(i)),O[0]=m[0],O[1]=m[1],O[2]=m[2]}return(n,e)=>{const m=b("el-option"),i=b("el-select"),k=b("el-checkbox"),T=b("el-input-number"),w=b("el-table-column"),W=b("el-table"),X=b("el-main"),P=b("el-container"),j=b("el-step"),Y=b("el-steps"),re=b("el-scrollbar"),H=b("el-button"),K=b("el-col"),ie=b("el-row"),de=b("el-aside");return r(),G(P,{class:"layout-container",style:{height:"100%"}},{default:d(()=>[s(P,null,{default:d(()=>[s(X,null,{default:d(()=>[u.value==0?(r(),v("div",_e,[e[6]||(e[6]=t("h1",null,"- 选择集装箱",-1)),t("div",we,[s(i,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),placeholder:"Select",size:"large",style:{width:"240px"}},{default:d(()=>[(r(!0),v(z,null,B(f(C),(l,p)=>(r(),G(m,{key:l.name,label:l.name,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e[7]||(e[7]=t("h1",null,"- 选择货物种类及数量",-1)),s(i,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),multiple:"",clearable:"","collapse-tags":"",placeholder:"Select goods","popper-class":"custom-header","max-collapse-tags":1,style:{width:"240px"}},{header:d(()=>[s(k,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=l=>N.value=l),indeterminate:U.value,onChange:ne},{default:d(()=>e[5]||(e[5]=[c(" 全选 ")])),_:1},8,["modelValue","indeterminate"])]),default:d(()=>[(r(!0),v(z,null,B(f(y),(l,p)=>(r(),G(m,{key:p,label:l.name,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(r(!0),v(z,null,B(_.value,(l,p)=>(r(),v("div",ke,[c(" 货物 "+a(f(y)[l].name)+" 数量为 ",1),s(T,{min:1,modelValue:A.value[p],"onUpdate:modelValue":F=>A.value[p]=F},null,8,["modelValue","onUpdate:modelValue"])]))),256))])):u.value==1?(r(),v("div",Ce,[e[9]||(e[9]=t("h2",null,"最终确认",-1)),t("div",he," 集装箱："+a(f(g).name),1),t("div",Ve,[e[8]||(e[8]=t("h3",null,"货物清单",-1)),s(W,{data:f(g).boxes,stripe:"",style:{width:"100%"}},{default:d(()=>[s(w,{prop:"id",label:"编号",width:"auto"}),s(w,{label:"货物名称",width:"auto"},{default:d(({row:l})=>[c(a(f(y)[l.id].name),1)]),_:1}),s(w,{prop:"lx",label:"长",width:"auto"}),s(w,{prop:"ly",label:"宽",width:"auto"}),s(w,{prop:"lz",label:"高",width:"auto"}),s(w,{label:"数量",width:"auto"},{default:d(({row:l,$index:p})=>[c(a(f(g).num_list[p]),1)]),_:1}),s(w,{label:"货物质量",width:"auto"},{default:d(({row:l})=>[c(a(f(y)[l.id].mass),1)]),_:1})]),_:1},8,["data"])])])):u.value==2?(r(),v("div",Se,[s(me,{main_containers:ue,module_containers:M,boxes:D,centerOfGravity:O},null,8,["main_containers","module_containers","boxes","centerOfGravity"])])):E("",!0)]),_:1})]),_:1}),s(de,{"max-width":"25%",style:{display:"flex","flex-direction":"column"}},{default:d(()=>[s(re,null,{default:d(()=>[t("div",Ee,[s(Y,{style:{"max-width":"600px"},active:u.value,"finish-status":"success","align-center":""},{default:d(()=>[s(j),s(j)]),_:1},8,["active"])]),u.value==0?(r(),v("div",ze," - 选择集装箱、货物种类及数量 ")):E("",!0),u.value==1?(r(),v("div",Be,[s(xe,{title:"货物使用情况","legend-data":oe.value,"series-data":ae.value},null,8,["legend-data","series-data"])])):E("",!0),u.value==2&&o.value!=null?(r(),v("div",Ue,[t("div",{class:"sidebarbox",onClick:e[4]||(e[4]=l=>$(o.value.container.allbox,o.value.container.allmodules,o.value.container.gravityCenter))},[t("h2",null,"集装箱:"+a(o.value.container.name),1),e[10]||(e[10]=t("b",null,"模块总容积:",-1)),e[11]||(e[11]=t("br",null,null,-1)),c(a(o.value.container.volumn)+" 平方厘米 ",1),e[12]||(e[12]=t("br",null,null,-1)),e[13]||(e[13]=t("b",null,"货物体积:",-1)),e[14]||(e[14]=t("br",null,null,-1)),c(a(o.value.container.boxesvolumn)+" 平方厘米 ",1),e[15]||(e[15]=t("br",null,null,-1)),e[16]||(e[16]=t("b",null,"体积利用率:",-1)),c(a((o.value.container.volumnUR*100).toFixed(3))+"% ",1),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=t("b",null,"重心坐标:",-1)),e[19]||(e[19]=t("br",null,null,-1)),c(" x:"+a(h(o.value.container.gravityCenter)[0])+" y:"+a(h(o.value.container.gravityCenter)[1])+" z:"+a(h(o.value.container.gravityCenter)[2])+" ",1),e[20]||(e[20]=t("br",null,null,-1)),e[21]||(e[21]=t("b",null,"中心坐标:",-1)),e[22]||(e[22]=t("br",null,null,-1)),c(" x:"+a(h(x.value)[0])+" y:"+a(h(x.value)[1])+" z:"+a(h(x.value)[2])+" ",1),e[23]||(e[23]=t("br",null,null,-1)),e[24]||(e[24]=t("b",null,"相对中心偏移:",-1)),e[25]||(e[25]=t("br",null,null,-1)),c(" x:"+a((x.value[0]-o.value.container.gravityCenter[0]).toFixed(3))+" y:"+a((x.value[1]-o.value.container.gravityCenter[1]).toFixed(3))+" z:"+a((x.value[2]-o.value.container.gravityCenter[2]).toFixed(3))+" ",1),(r(!0),v(z,null,B(o.value.container.restBoxnum,(l,p)=>(r(),v("div",{class:"hw",key:p},[l?(r(),v("div",Ae,a(f(y)[f(g).boxes[p].id].name)+" 剩余数量为 "+a(o.value.container.restBoxnum[p]),1)):E("",!0)]))),128)),e[26]||(e[26]=t("br",null,null,-1)),t("button",{onClick:e[3]||(e[3]=l=>$(o.value.container.allbox,o.value.container.allmodules,o.value.container.gravityCenter))},"3D")]),(r(!0),v(z,null,B(o.value.modules,(l,p)=>(r(),v("div",{class:"sidebarbox",key:`module_${l.name}_${p}`,onClick:F=>$(l.boxes,[l.showModule],l.gravityCenter)},[t("h4",null,"模块:"+a(l.name),1),e[27]||(e[27]=t("b",null,"模块容积:",-1)),c(a(l.volumn)+" 平方厘米 ",1),e[28]||(e[28]=t("br",null,null,-1)),e[29]||(e[29]=t("b",null,"货物体积:",-1)),c(a(l.boxesvolumn)+" 平方厘米 ",1),e[30]||(e[30]=t("br",null,null,-1)),e[31]||(e[31]=t("b",null,"体积利用率:",-1)),c(a((l.volumnUR*100).toFixed(3))+"% ",1),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=t("b",null,"重心坐标:",-1)),c(a(h(l.gravityCenter))+" ",1),(r(!0),v(z,null,B(l.num_list,(F,Z)=>(r(),v("div",{class:"hw",key:`hw_${l.name}_${Z}`},[F?(r(),v("div",Fe,a(f(y)[f(g).boxes[Z].id].name)+" 数量为 "+a(l.num_list[Z]),1)):E("",!0)]))),128)),(r(),v("button",{key:`module_${l.name}`,onClick:F=>$(l.boxes,[l.showModule],l.gravityCenter)},"3D",8,Le))],8,$e))),128))])):E("",!0)]),_:1}),t("div",Ne,[s(ie,{gutter:20,align:"middle"},{default:d(()=>[s(K,{span:8},{default:d(()=>[s(H,{type:"primary",plain:"",onClick:le,style:{width:"100%"}},{default:d(()=>e[34]||(e[34]=[c(" 上一步 ")])),_:1})]),_:1}),s(K,{span:16},{default:d(()=>[s(H,{type:"primary",plain:"",onClick:ee,style:{width:"100%"}},{default:d(()=>e[35]||(e[35]=[c(" 下一步 ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})}}}),Te=fe(Me,[["__scopeId","data-v-58cb83f0"]]);export{Te as default};
